<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>交易记录</title>
    <link rel="icon" href="../../favicon2018921.ico" type="image/x-icon"/>
    <script src="../../js/appcommon.js"></script>
</head>
<style>
    .seedcontain{padding: 0}
    .tab-panel{background: none}
    .m-cell:after{border: 0 !important}
    .tab-nav-item{ background: #FFF !important;}
    .cell-item:not(:last-child){border-bottom: #f3f3f3 solid 1px}
</style>
<body>
<div id="htmlWap" v-cloak>
        <header class="m-navbar">
            <a href="javascript:history.go(-1);"  class="navbar-item">
                <i class="back-ico"></i>
            </a>
            <div class="navbar-center">
                <span class="navbar-title">交易记录</span>
            </div>
            <a href="javascript:;" @click="goorderdetail(token)" class="navbar-item">
                挂单记录
            </a>
        </header>
    <div class="seedcontain seedbg">
        <ul class="tab-nav">
            <li class="tab-nav-item"  :class="tabactive?'tab-active':''" @click="saletab(0)"><a href="javascript:;">我出售的</a></li>
            <li class="tab-nav-item"  :class="tabactive2?'tab-active':''" @click="saletab(1)"><a href="javascript:;">我购买的</a></li>
        </ul>

        <div class="seedWcontainr">
            <div class="tab-panel-item">
                    <div class="m-cell seedWbg" @click="dealdetail(token,getType,item)" v-for="item in orderlist">
                        <section class="cellLR bottborl">
                            <span class="left_cell blacktext" v-if="getType==20"  style="flex:1"><span class="sellIcon margr10"><img src="../../images/seed/icon-chushou@2x.png" /></span>出售树苗</span>
                            <span class="left_cell blacktext" v-if="getType==10" style="flex:1"><span class="sellIcon margr10"><img src="../../images/seed/icon-goumai@2x.png" /></span>购买树苗</span>
                            <span class="right_cell fontcolorB" style="flex:1;">{{item.buyTime}}</span>
                        </section>
                        <section class="cellLR ">
                            <span class="left_cell fontcolorB" v-if="getType==10" style="flex:1">卖家</span>
                            <span class="left_cell fontcolorB" v-if="getType==20" style="flex:1">买家</span>
                            <span class="right_cell" style="flex:1">{{item.sellerUserNickname}}</span>
                        </section>
                        <section class="cellLR ">
                            <span class="left_cell fontcolorB" style="flex:1">单价</span>
                            <span class="right_cell" style="flex:1">{{item.goodsPrice}}BGT/棵</span>
                        </section>
                        <section class="cellLR ">
                            <span class="left_cell fontcolorB" style="flex:1">总价</span>
                            <span class="right_cell" style="flex:1">{{item.payMoney}}BGT</span>
                        </section>
                        <section class="cellLR" v-if="getType==20">
                            <span class="left_cell fontcolorB" style="flex:1">手续费</span>
                            <span class="right_cell" style="flex:1">{{item.sxFee}}BGT {{item.sxFee/item.payMoney*100}}%</span>
                        </section>
                        <section class="cellLR bottborl">
                            <span class="left_cell fontcolorB" style="flex:1">订单号</span>
                            <span class="right_cell" style="flex:1">{{item.orderNo}}</span>
                        </section>
                        <section class="cellLR lh12">
                            <span class="left_cell fontcolorB" style="flex:1">数量<span class="blacktext mar_l5">{{item.buyNum}}</span></span>
                            <span class="right_cell blacktext" style="flex:1">交易成功</span>
                        </section>
                    </div>
                    <p class="nodata" v-if="orderlist.length==0">暂无数据</p>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    /* 获取头部信息 */
    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) {
            return r[2];
        }
    };
    $(function () {
        new Vue({
            el: '#htmlWap',
            data: {
                token:GetQueryString('token'),//头部获取。,
                userphoto:"../../images/notuserphoto.png",
                tabactive: true,
                tabactive2: false,
                getType:20,       //订单状态10：我购买的订单 20：我出售的订单
                orderlist:[]        //订单列表
            },
        methods:{
            getlist: function () {
                    var that=this;
                    that.orderlist=[];
                    this.$http({
                        method: "post",
                        url: fund+ "/appSceneGoodsOrder/getOrderList",
                        data: {
                            token: this.token,
                            getType: this.getType,
                            platform: 'H5'
                        },
                        emulateJSON: true
                    }).then(function (data) {
                        console.log(data);
                        if(data.data.code==0){
                            if(data.data.data){
                                for (var i  in data.data.data.list) {
                                        var item = data.data.data.list[i]
                                            that.orderlist.push(item);
                                }
                            }
                            
                        }else{
                            layer.msg(data.data.message)
                        }
                               
                            }, function (error) {
                        layer.msg('接口出错');
                    })
                },       
            saletab:function(type){
                    if(type==0){
                        this.tabactive=true;
                        this.tabactive2=false;
                        this.getType =20;
                        this.getlist();
                    }else if(type==1){
                        this.tabactive=false;
                        this.tabactive2=true;
                        this.getType =10;
                        this.getlist();
                    }
                },
            dealdetail:function(token,getType,item){
                window.location.href="dealDetail.html?token="+token+"&getType="+getType+"&orderNo="+item.orderNo;
            },
            goorderdetail:function(token){
                window.location.href="orderDetail.html?token="+token;
            },
            goback:function(){
                window.location.href="treeDeal.html?token="+this.token
            }
        },
        mounted:function(){
            this.getlist()
        }
    })
    });
</script>
</html>